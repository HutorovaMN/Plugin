# Описание

Плагин для отображения табличных данных, их редактирования и сохранения

## Редактируемые поля

Ректируемые значения в таблице устанавливаются путем установки в **headers** при помощи указания флага **editable** и опций **save**

```yaml
---
headers:
  - value: name
    text: Имя
    editable: true
    # editable - Возможность редактирования
    # Дефолтное значение:  true
    # Допустимые значения: true / false
    # При "editable: true" так же необходимо заполнить опции для сохранения (save)
    save:
      # save - опции для сохранения данных из данной колонки
      path: favorite.yaml
      # path - путь к файлу для сохранения
      # Важно: при указании одинаковых значений в разных колонках - данные смержатся
      entity: favorite-ice-cream.yaml
      # entity - Идентификатор (ключ) под которым будет осуществлено сохранение в файл

  - value: smile
    text: Улыбнулся
    width: 100px
    type: checkbox
    editable: true
    save:
      path: favorite.yaml
      entity: favorite-ice-cream.yaml
---
```

**Важно: При сохранении будет создан файл `favorite-ice-cream.yaml`. Если файл уже существует - он будет перезаписан, а все коментарии - удалены.**

## Мутация заголовков

В качестве входных данных таблица (поле `source`) ожидает объект c полями

| ключ    | обязательное | описание                                                                              |
| ------- | ------------ | ------------------------------------------------------------------------------------- |
| body    | да           | Содержит данные для построения таблицы                                                |
| headers | нет          | Содержит данные для заголовков. Значение мержится с заголовками, описанными в таблице |

Такая структура позволяет динамически описывать, использовать JSONata-выражения для построения и параметризовать значения для заголовков.

### Описание :

```yaml
dochub.editable-table.preset-2:
  type: editable-table
  filtration: false
  headers:
    - value: column_1
      text: Колонка 1
      width: 150px
    - value: column_2
      text: Колонка 2
      width: 150px
      style:
        color: red
  source: >
    ( 
      $headers := [
        {
          "value": "column_2",
          "style": {
            "backgroundColor": "gray"
          }
        },
        { "value": "column_3", "width": "250px", "text": "Новая колонка" }
      ];

      $body := {
        "row_1": {"column_1": "11", "column_2": "12", "column_3": "13"},
        "row_2": {"column_1": "21", "column_2": "22", "column_3": "23"}
      };
      
      {
        "headers": $headers,
        "body": $body
      }
    )
```

### Результат:

В результате была изменена колонка **column_2** и добавлена новая колонка **column_3**


| Значение            | Описание                             | Обязательное | Допустимые значения                       | Значение по умолчанию |
| ------------------- | ------------------------------------ | ------------ | ----------------------------------------- | --------------------- |
| type                | Тип документа                        | +            | editable-table                            |                       |
| page_size           | Количество строк на странице         |              | Положительные целые числа                 | 20                    |
| selection           | Отражение чекбоксов для выбора строк |              | false / true                              | false                 |
| filtration          | Глобальное отключение фильтров       |              | true / false                              | true                  |
| direction           | Направление таблицы                  |              | ltr (left to right) / ttb (top to bottom) | ltr                   |
| [headers](#headers) | Массив заголовков                    | +            |                                           |                       |
| [format](#format)   | Форматирование данных при сохранении |              |                                           |                       |
| source              | JSONata запрос                       | +            |                                           |                       |

## format

JSONata выражение позволяющее преобразовать данные перед сохранением
Перед сохранением данных осуществляться загрузка данных по указанному пути.
Данные из файла доступны как параметр (origin) "file" (зарезервированное имя)
Данные из таблицы доступны как параметр (origin) "table" (зарезервированное имя)

## headers

| Значение            | Описание                                               | Обязательное | Допустимые значения                                    | Значение по умолчанию      |
| ------------------- | ------------------------------------------------------ | ------------ | ------------------------------------------------------ | -------------------------- |
| value               | Идентификатор поля для вывода в колонке                | +            |                                                        |                            |
| text                | Отображаемый заголовок                                 |              |                                                        | value (идентификатор поля) |
| width               | Ширина колонки (px) (100px, 200px, ...)                | +/-          |                                                        |                            |
| filterable          | Позволяет отключить фильтрацию                         |              | true / false                                           | true                       |
| sortable            | Позволяет запретить сортировку                         |              | true / false                                           | true                       |
| [type](#type)       | Тип ячеек для указанной колонки                        |              | text / select / multiple-select / checkbox / link / fn | text                       |
| [pinned](#pinned)   | Закрепить колонку при горизонтальном скроле            |              | true / false                                           | false                      |
| style               | Позволяет установить css-inline стили для колонки      |              |                                                        |                            |
| styles              | Позволяет установить css-inline и применить по условию |              |                                                        |                            |
| [options](#options) | Опции для типа "select" и "multiple-select"            | +/-          |                                                        |                            |
| editable            | Возможность редактирования ячеек                       |              | true / false                                           | false                      |
| [save](#save)       | Опции сохранения данных из колонки                     |              |                                                        |                            |

### type

| Имя                                 | Описание                              | Дополнительные поля          |
| ----------------------------------- | ------------------------------------- | ---------------------------- |
| [text](#text)                       | Текстовое поле                        |                              |
| [select](#select)                   | Поле с одиночным выбором значения     | Трубуется значение "options" |
| [multiple-select](#multiple-select) | Поле с множественным выбором значения | Трубуется значение "options" |
| [checkbox](#checkbox)               | Чекбокс                               |                              |
| [link](#link)                       | Ссылка                                |                              |
| [fn](#fn)                           | Вычисляемое значение                  |                              |

#### text

Строка или другое приводимое значение

#### select

Строка или другое приводимое значение

В `options` ожидает массив объектов, с обязательным полем `value` (идентификатор) и опциональным `text` (значение отражаемое в таблице).

Пример:

```JSON
[
  {"value": "red", "text": "красный"},
  {"value": "green", "text": "зеленый"},
  {"value": "blue"}
]
```

#### multiple-select

Массив строк или других приводимых значений.

В `options` ожидает массив объектов, с обязательным полем `value` (идентификатор) и опциональным `text` (значение отражаемое в таблице).

Пример:

```JSON
[
  {"value": "red", "text": "красный"},
  {"value": "green", "text": "зеленый"},
  {"value": "blue"}
]
```

#### checkbox

Булевое значение

#### link

1. Текст:

`https://www.google.ru/`

2. Объект:

```JSON
  {
    "href": "/architect/components/system.auth",
    "text": "Авторизация"
  }
```

3. Массив объектов:

```JSON
  [
      {
          "href": "https://www.google.ru/",
          "text": "google"
      },
      {
          "href": "/docs/example",
          "text": "Пример документа"
      }
  ]
```

#### fn

Ожидает JSONata выражение. Ячейка является НЕ редактируемым, значение вычисляется по переданному выражению.

Данные из текущей строки  доступны как параметр (`origin`) `row` (зарезервированное имя)
Данные из `origin` доступны как параметры с соответствующими именами

Пример выражения:

```
  (
      $sum := $number(row.'column_1') + $number(row.'column_2');
      $sum * multiplication.num
  )
```
`multiplication` - origin описанный в таблице (см. пример)

### pinned

При "pinned: true" необходимо явно установить значение `width`

### save

| Значение | Описание                                                                                           | Обязательное |
| -------- | -------------------------------------------------------------------------------------------------- | ------------ |
| path     | Путь к файлу для сохранения. при указании одинаковых значений в разных колонках - данные смержатся | +            |
